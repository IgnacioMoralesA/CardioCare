<div class="report-container">

  <div class="header-section">
    <h2><i class="fas fa-file-medical-alt"></i> Generador de Reportes</h2>
    <p>Seleccione una categoría para filtrar y descargar.</p>
  </div>

  <div class="toolbar">

    <div class="filter-group">
      <button (click)="filterBy(null)"
              [class.active]="currentFilter === 'Completo'">
        Reporte Completo
      </button>

      <button (click)="filterBy('Alta')"
              [class.active]="currentFilter === 'Prioridad Alta'" class="btn-high">
        Alta
      </button>

      <button (click)="filterBy('Media')"
              [class.active]="currentFilter === 'Prioridad Media'" class="btn-mid">
        Media
      </button>

      <button (click)="filterBy('Baja')"
              [class.active]="currentFilter === 'Prioridad Baja'" class="btn-low">
        Baja
      </button>
    </div>

    <button class="btn-download" (click)="downloadPDF()" [disabled]="loading || filteredReports.length === 0">
      <i class="fas fa-file-pdf"></i> Descargar PDF
    </button>

  </div>

  <div class="table-responsive">

    <div *ngIf="loading" class="state-msg">Cargando datos...</div>
    <div *ngIf="errorMessage" class="state-msg error">{{ errorMessage }}</div>

    <table *ngIf="!loading && filteredReports.length > 0" class="report-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>RUT</th>
        <th>Nombre</th>
        <th>Edad</th>
        <th>Prioridad</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let r of filteredReports">
        <td>{{ r.id }}</td>
        <td>{{ r.rut }}</td>
        <td>{{ r.nombre }} {{ r.apellido }}</td>
        <td>{{ r.edad }}</td>
        <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-high': r.prioridad === 'Alta',
                    'bg-mid': r.prioridad === 'Media',
                    'bg-low': r.prioridad === 'Baja'
                  }">
              {{ r.prioridad }}
            </span>
        </td>
      </tr>
      </tbody>
    </table>

    <div *ngIf="!loading && filteredReports.length === 0" class="state-msg">
      No se encontraron pacientes en esta categoría.
    </div>

  </div>
</div>
