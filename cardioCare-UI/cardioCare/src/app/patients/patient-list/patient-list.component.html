<div class="patient-container">

  <header>
    <h2>Gesti√≥n de Pacientes</h2>
    <p>Administraci√≥n de fichas y datos demogr√°ficos.</p>
  </header>

  <section class="form-card">
    <h3>Nueva Ficha Cl√≠nica</h3>
    <p class="hint">Asocia datos m√©dicos a un usuario registrado previamente.</p>

    <form [formGroup]="patientForm" (ngSubmit)="onSubmit()" class="patient-form">

      <div class="form-row">
        <div class="form-group">
          <label>ID Usuario</label>
          <input type="number" formControlName="userId" placeholder="Ej: 10">
        </div>

        <div class="form-group">
          <label>G√©nero</label>
          <select formControlName="gender">
            <option value="" disabled>Seleccione...</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
        </div>

        <div class="form-group">
          <label>Fecha Nacimiento</label>
          <input type="date" formControlName="birthDate">
        </div>

        <div class="form-group">
          <label>Fecha Cirug√≠a (Opcional)</label>
          <input type="date" formControlName="surgeryDate">
        </div>
      </div>

      <div class="form-group full-width">
        <label>Condici√≥n M√©dica / Diagn√≥stico Base</label>
        <textarea formControlName="medicalCondition" rows="2" placeholder="Ej: Hipertensi√≥n, Post-operatorio bypass..."></textarea>
      </div>

      <button type="submit" [disabled]="patientForm.invalid" class="btn-primary">
        + Crear Ficha
      </button>
    </form>
  </section>

  <hr>

  <div *ngIf="errorMessage" class="alert-error">
    {{ errorMessage }}
  </div>

  <div class="table-responsive" *ngIf="!loading && !errorMessage">
    <table class="clinical-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Edad / Nacimiento</th>
        <th>Condici√≥n</th>
        <th>Cirug√≠a</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let p of patients">
        <td>{{ p.id }}</td>
        <td class="fw-bold">
          {{ p.name }}<br>
          <small class="text-muted">{{ p.email }}</small>
        </td>
        <td>{{ p.birthDate | date:'dd/MM/yyyy' }}</td>
        <td>{{ p.medicalCondition }}</td>
        <td>
          <span *ngIf="p.surgeryDate">{{ p.surgeryDate | date:'dd/MM/yyyy' }}</span>
          <span *ngIf="!p.surgeryDate" class="text-muted">-</span>
        </td>
        <td class="actions">
          <button class="btn-icon view" (click)="goToDetail(p.id)" title="Ver Detalle">üëÅÔ∏è</button>
          <button class="btn-icon delete" (click)="deletePatient(p.id)" title="Eliminar">üóëÔ∏è</button>
        </td>
      </tr>
      <tr *ngIf="patients.length === 0">
        <td colspan="6" class="text-center">No hay pacientes registrados.</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
